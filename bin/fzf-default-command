#!/usr/bin/env bash

# Show absolute path or relative path, which is shorter
compact() {
	while read line; do
		local ABS="$line"
		local REL=${ABS#$PWD/}
		REL=${REL:-.}

		echo ${REL}
	done
}

get_project_root() {
	if [ -n "$1" ]; then
		cd "$1"
	fi
	local PROJECT_ROOT="$(git rev-parse --show-toplevel 2>/dev/null)"
	echo "${PROJECT_ROOT:-$PWD}"
}


directory="${1}"
if [ -z "$directory" ]; then
	directory=$(get_project_root "${directory}")
fi

cat \
	<(fd . ${directory}) \
	<(< "${ZSHZ_DATA:-$XDG_CACHE_HOME/z}" sort -t '|' -k 2,3 -rn | cut -d '|' -f 1) | \
compact |\
awk '!x[$0]++' |\
sed "s:$HOME:~:"

